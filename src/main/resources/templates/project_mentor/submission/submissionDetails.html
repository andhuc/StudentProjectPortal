<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title th:text="${@title}"></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Premium Bootstrap 4 Landing Page Template"/>
    <meta name="keywords" content="Appointment, Booking, System, Dashboard, Health"/>
    <meta name="author" content="Shreethemes"/>
    <meta name="email" content="support@shreethemes.in"/>
    <meta name="website" content="../../../index.html"/>
    <meta name="Version" content="v1.2.0"/>
    <!-- favicon -->
    <link rel="shortcut icon" th:href="@{/images/favicon.ico.png}">
    <!-- Bootstrap -->
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" type="text/css"/>
    <!-- simplebar -->
    <link th:href="@{/css/simplebar.css}" rel="stylesheet" type="text/css"/>
    <!-- Select2 -->
    <link th:href="@{/css/select2.min.css}" rel="stylesheet"/>
    <!-- Date picker -->
    <link rel="stylesheet" th:href="@{/css/flatpickr.min.css}">
    <link th:href="@{/css/jquery.timepicker.min.css}" rel="stylesheet" type="text/css"/>
    <!-- Icons -->
    <!--    <link th:href="@{/css/materialdesignicons.min.css}" rel="stylesheet" type="text/css"/>-->
    <link th:href="@{/css/remixicon.css}" rel="stylesheet" type="text/css"/>
    <script th:src="@{https://use.fontawesome.com/releases/v6.3.0/js/all.js}" crossorigin="anonymous"></script>
    <!-- Css -->
    <link th:href="@{/css/style.min.css}" rel="stylesheet" type="text/css" id="theme-opt"/>
    <link th:href="@{/css/tablestyles.css}" rel="stylesheet"/>
    <link th:href="@{/css/modal.css}" rel="stylesheet" type="text/css"/>
    <script th:src="@{https://code.jquery.com/jquery-3.5.1.js}"></script>
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <link th:href="@{/css/notify.css}" rel="stylesheet" type="text/css"/>
    <script th:src="@{/js/notify.js}"></script>
    <!-- Include DataTables CSS -->
    <link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <script th:src="@{https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js}"></script>

    <script th:src="@{https://code.jquery.com/jquery-3.3.1.min.js}"></script>
</head>
<body>
<!-- Loader -->
<div id="preloader">
    <div id="status">
        <div class="spinner">
            <div class="double-bounce1"></div>
            <div class="double-bounce2"></div>
        </div>
    </div>
</div>
<!-- Loader -->
<div class="page-wrapper doctris-theme toggled">
    <!-- sidebar-wrapper  -->
    <div th:replace="~{dashboardSidebar}"></div>
    <main class="page-content bg-light">
        <div th:replace="~{dashboardHeader}"></div>
        <div class="container-fluid">
            <div class="layout-specing">

                <div>
                    <h4 class="mb-0">Submit Details</h4>
                    <ol class="breadcrumb mb-4">
                        <li class="breadcrumb-item"><a href="../home">Dashboard</a></li>
                        <li class="breadcrumb-item">/</li>
                        <li class="breadcrumb-item">
                            <a th:if="${isMentor}" th:href="'/project-mentor/milestone/list/' + ${submission.project.id}">Assignment List</a>
                            <a th:if="${!isMentor}" th:href="'/student/milestone/list/' + ${submission.project.id}">Assignment List</a>
                        </li>
                        <li class="breadcrumb-item">/</li>
                        <li class="breadcrumb-item active">Submit Details</li>
                    </ol>
                </div>

                <div class="row mt-4">
                    <h5 th:text="'Milestone: ' + ${submission.milestone.title}"></h5>
                    <p th:text="'Group: ' + ${submission.project.groupName} + ' - ' + ${submission.project.aclass.className}"></p>
                    <label>Submission:
                        <a target="_blank" th:href="${submission.pathFile}" th:text="${submission.fileLocation}"></a>
                    </label>
                </div>

                <div class="row mt-4">

                    <div class="col-2">
<!--                        <select class="form-select">-->

<!--                        </select>-->
                    </div>

                </div>

                <div class="row mt-3">
                    <div class="col-10">

                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Issue</th>
                                    <th>Assignee</th>
                                    <th>Status</th>
                                    <th>LOC</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="submitIssue : ${submitIssueList}" class="submitIssue">
                                    <td th:text="${submitIssue.id}"></td>
                                    <td th:text="${submitIssue.issue.title}"></td>
                                    <td th:text="${submitIssue.issue.assignee.fullName}"></td>
                                    <td>
                                        <div th:if="${submitIssue.functionLoc!=null}">
                                            Evaluated
                                        </div>
                                        <div th:if="${submitIssue.functionLoc==null}">
                                            Submitted
                                        </div>
                                    </td>
                                    <td>
                                        <div th:if="${submitIssue.functionLoc!=null}" th:text="${submitIssue.functionLoc}">
                                        </div>
                                    </td>
                                    <td>
                                        <div th:if="${isMentor}" class="btn btn-link">
<!--                                            <div th:onclick="'detailsSubjectSetting(' + ${setting.id} + ')'" style="border: none; background-color: white; color: blue">-->
<!--                                                Evaluate-->
<!--                                            </div>-->
                                            <div th:onclick="showLoc();" style="border: none; background-color: white; color: blue;">
                                                Evaluate
                                            </div>

                                        </div>
                                        <div th:if="${!isMentor}" class="btn btn-link">Result</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                    </div>

                </div>

                <button type="button" id="btndetails1" data-toggle="modal" data-target="#detailsModalCenter1" hidden="hidden"></button>
                <!--  Detail Modal-->
                <div class="modal fade" id="detailsModalCenter1" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="detailsModalLongTitle1">LOC EVLATUTION</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="border: none; background-color: white;">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="row justify-content-center">
                                    <div class="col-md-12 row" style="margin-top: 12px;">
                                        <div class="mb-3 col-md-6">
                                            <label class="form-label">Subject Code</label>
                                            <input type="text" name="subjectCode" class="form-control" th:value="${submission.project.aclass.subject.subjectCode}" readonly disabled>
                                        </div>
                                        <div class="mb-3 col-md-6">
                                            <label class="form-label">Milstone</label>
                                            <input type="text" name="subjectCode" class="form-control" th:value="${submission.milestone.title}" readonly disabled>
                                        </div>
                                        <div class="mb-3 col-md-6">
                                            <label class="form-label">Complexity<span class="text-danger">*</span></label>
                                            <select id="details-submit-issue-complexity" class="form-select">
                                                <option value="1">High</option>
                                                <option value="1">Medium</option>
                                                <option value="1">Low</option>
                                            </select>
                                        </div>
                                        <div class="mb-3 col-md-6">
                                            <label class="form-label">Quality<span class="text-danger">*</span></label>
                                            <select id="details-submit-issue-quality" class="form-select">
                                                <option value="1">High</option>
                                                <option value="1">Medium</option>
                                                <option value="1">Low</option>
                                            </select>
                                        </div>
                                        <div class="mb-3 col-md-6">
                                            <label class="form-label">Function Loc<span class="text-danger">*</span></label>
                                            <input type="text" id="details-subject-setting-value" class="form-control" >
                                        </div>
                                    </div><!--end col-->
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="detailcloseModal1">Close</button>
                                <button type="button" class="btn btn-primary" id="updateSubjectSettingButton">Update</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detail-->
                <script>

                    function showLoc(){
                        console.log("showLoc hihi")
                        document.getElementById('btndetails1').click();
                    }
                    function detailsSubjectSetting(id) {
                        console.log('show detail'+id)
                        let endPoint = '/api/v1/subject-setting?subjectSettingId=' + id;
                        fetch(endPoint)
                            .then(response => {
                                if (response.ok) {
                                    // Handle a successful API response
                                    response.json().then(data => {
                                        document.querySelector('input[id="details-subject-setting-title"]').value = data.title;
                                        document.querySelector('input[id="details-subject-setting-value"]').value = data.value;
                                        document.querySelector('input[id="details-subject-setting-display-order"]').value = data.displayOrder;
                                        var selectElement = document.querySelector('select[id="details-subject-setting-type"]');
                                        var dataValue = data.typeId;
                                        for (var i = 0; i < selectElement.options.length; i++) {
                                            // Nếu giá trị của option khớp với giá trị từ dữ liệu, đặt selected
                                            if (selectElement.options[i].value == dataValue) {
                                                selectElement.options[i].selected = true;
                                                break; // Dừng vòng lặp nếu đã tìm thấy giá trị khớp
                                            }
                                        }
                                        // document.querySelector('select[id="details-subject-setting-type"]').value = data.typeId;
                                        document.getElementById('detail-subject-setting-status').checked = data.status == 1 ? true : false;
                                        document.getElementById('updateSubjectSettingButton').setAttribute('onclick', 'updateSubjectSetting(' + data.id + ')');
                                    });
                                } else {
                                    // Handle API errors
                                    console.error('Error getting issue setting.');
                                }
                            })
                            .catch(error => {
                                // Handle network errors
                                console.error('Network error:', error);
                            });
                        document.getElementById('btndetails1').click();
                    }
                </script>

                <!--Update Subject Setting-->
                <script>
                    function updateSubjectSetting(id){
                        console.log('updateSubjectSetting '+ id);
                        const subjectId = document.querySelector('input[name="id"]').value;
                        const typeId = document.querySelector('select[id="details-subject-setting-type"]').value;
                        const title = document.querySelector('input[id="details-subject-setting-title"]').value;
                        const value = document.querySelector('input[id="details-subject-setting-value"]').value;
                        const displayOrder = document.querySelector('input[id="details-subject-setting-display-order"]').value;
                        const status = document.getElementById('detail-subject-setting-status').checked ? 1 : 0;
                        let endPoint = '/api/v1/update/subject-setting?subjectSettingId=' + id +
                            '&subjectId=' + subjectId +'&typeId=' +typeId + '&title=' + title + '&value=' +
                            value + '&displayOrder=' + displayOrder + '&status=' + status;

                        fetch(endPoint, {
                            method: 'GET',
                        })
                            .then(response => {
                                if(response.ok) {
                                    notify('success','Update subject setting successfully' , 'Success');
                                    setTimeout(() => {
                                        location.reload();
                                    }, 1000);
                                } else  {
                                    // notify('error' ,response.text()  ,'Error' );
                                    return response.text();
                                }
                            })
                            .then(errorText =>{
                                if(errorText && !errorText.startsWith('Update'))
                                    notify('error',errorText,'Error')
                            })
                            .catch(error => {
                                alert("Network error " + error);
                            });
                    }
                </script>

            </div>
        </div>
    </main>
</div>

<script>

</script>

<!-- javascript -->
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<!-- simplebar -->
<script th:src="@{/js/simplebar.min.js}"></script>
<!-- Icons -->
<script th:src="@{/js/feather.min.js}"></script>
<script th:src="@{https://code.jquery.com/jquery-3.5.1.js}"></script>
<script th:src="@{https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js}"></script>
</body>
</html>